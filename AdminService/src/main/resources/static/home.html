<!DOCTYPE html>
<html>

<head>
  <title>Home</title>
  <script>
    async function loadAuthorization() {
      const token = localStorage.getItem("Authorization");

      if (!token) {
        window.location.href = "/index.html";
      }
    }
  </script>
</head>

<body>
  <h1>Home Page</h1>

  <h2>Your uploaded documentation</h2>
  <div class="docs-container">
    <button id="load-docs" onclick="appendDocumentRow()">Load Documents</button>
    <table id="docs-table">
      <thead>
        <tr>
          <th>Document Type</th>
          <th>Size (bytes)</th>
          <th>Creation Date</th>
          <th>Expiration Date</th>
        </tr>
      </thead>
      <tbody id="docs-body"></tbody>

  </div>

  <h3>upload documentation</h3>
  <form>
    <input type="button" value="Upload" id="files">
    <input type="submit" onclick="upload()">
  </form>
</body>

<script>
  async function upload() {

    const files = document.getElementById("files").files;
    const totalSize = 0;
    for (const file of files) {
      totalSize += file.size;
    }
    if (files.length === 0) {
      alert("Please select a file to upload.");
      return;
    }
    const documents = JSON.stringify({
      "documents": files
    });
    const request = fetch("/from-token", {
      headers: {
        "Content-Type": "application/json",
        "token": localStorage.getItem("Authorization")
      }
    });
    const userId = await request;

    const data = JSON.stringify({
      "documents": documents,
      "operation": "upload",
      "user": userId,
      "size": totalSize
    });

    const uploadReponse = await fetch("/documentation/upload", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: {
        "token": localStorage.getItem("Authorization"),
        data
      }
    })
  }

  async function appendDocumentRow() {

    const table = document.getElementById("docs-table");

    const response = fetch("http://localhost:8080/documentation/get-docs", {
      headers: {
        "token": localStorage.getItem("Authorization")
      }
    })
      .then(response => response.json())
      .then(documents => {
        if (documents.length === 0) {
          alert("No documents found");
          return;
        }
        for (const document of documents) {
          const row = document.createElement("tr");
          row.innerHTML = `
    <tr>
      <td>${document.documentType}</td>
      <td>${document.size}</td>
      <td>${document.creationDate}</td>
      <td>${document.expirationDate}</td>
    </tr>
    `;
          table.appendChild(row);
        }
      })
      .catch(error => {
        alert("Failed to load documents: " + (error && error.message ? error.message : 'Network error'));
      });
  }
</script>

</html>
